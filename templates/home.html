<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Mini Twitter</title>
</head>
<body>
    <h1>Mini Twitter - Home</h1>

    <h2>Messages</h2>
    <div id="messages"></div>

    <h3>Nouveau message</h3>
    <input id="newMessage" placeholder="Ã‰cris ton message...">
    <button onclick="postMessage()">Poster</button>

<script>
    const params = new URLSearchParams(window.location.search);
    const currentUser = params.get("username");

    async function loadMessages() {
        let res = await fetch("/messages");
        let data = await res.json();
        let container = document.getElementById("messages");
        container.innerHTML = "";
        data.forEach(msg => {
            container.innerHTML += `<p><b>${msg.author}</b>: ${msg.content}</p>`;
        });
    }

    async function postMessage() {
        let content = document.getElementById("newMessage").value;
        if (!content) return;

        await fetch("/messages", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
                author: currentUser,
                content: content
            })
        });

        document.getElementById("newMessage").value = "";
        loadMessages(); // recharge la liste des messages
    }

    // Charger les messages automatiquement au chargement de la page
    window.onload = loadMessages;
</script>
</body>
</html>